<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: api/api_helpers.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: api/api_helpers.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import jwt from 'jsonwebtoken';
import jsonpatch from 'jsonpatch';
import status from 'http-status';
import Jimp from 'jimp';
import authToken from '../auth';
import jsonPatcher from '../utility/patcher';
import imageResizer from '../utility';

const applyJSONPatch = jsonPatcher(jsonpatch);
const createThumbnail = imageResizer(Jimp);

const { generateToken, decodeToken } = authToken(jwt);

export default {

  /**
     * Logs in a user into the service
     * @function loginUser
     * @param {Object} req - the request object
     * @param {Object} res - the response object
     * @param {Function} next - the next middleware
     */
  loginUser: (req, res, next) => {
    const { username, password } = req.body;
    if (!username || !password) {
      res.status(status.BAD_REQUEST)
        .json({
          message: 'Invalid Username &amp; Password: Username or Password cannot be empty',
          success: false
        });
    } else {
      const payload = {
        admin: true
      };

      generateToken(payload)
        .then((token) => {
          res.status(status.OK)
            .json({
              message: 'Accepted: Here\'s your token',
              success: true,
              token
            });
        })
        .catch((err) => {
          res.status(status.BAD_REQUEST)
            .json({
              message: err.message,
              success: false
            });
        });
    }
  },

  /**
     * Creates an image thumbnail and returns it
     * @function createImageThumbnail
     * @param {Object} req - the request object
     * @param {Object} res - the response object
     * @param {Function} next - the next middleware
     */

  createImageThumbnail: (req, res, next) => {

    // we want to service http|https requests ONLY
    const { imageUrl } = req.body;
    if(imageUrl) {
      createThumbnail(imageUrl)
        .then((resizedImage) => {
          res.status(status.OK)
            .json({
              message: `Image ${imageUrl} was resized to a 50px by 50px image`,
              payload: resizedImage,
              success: true
            });
        })
        .catch((err) => {
          res.status(status.BAD_REQUEST)
            .json({
              message: err.message,
              success: false
            });
        });
    } else {
      res.status(status.BAD_REQUEST)
        .json({
          message: 'Please provide a URL of an image in the format (.jpg, .jpeg, .png, or .bmp)',
          success: false
        });
    }
  },

  /**
     * Creates a JSON patch of a document
     * @function jsonPatch
     * @param {Object} req - the request object
     * @param {Object} res - the response object
     * @param {Function} next - the next middleware
     */
  jsonPatch: (req, res, next) => {
    const { patch, document } = req.body;
    applyJSONPatch(document, patch)
      .then((patchedDoc) => {
        res.status(status.OK)
          .json({
            success: true,
            patchedDoc
          });
      })
      .catch((err) => {
        res.json({
          success: false,
          message: err.message
        });
      });
  },
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-api_thumbnailer.html">api/thumbnailer</a></li><li><a href="module-auth_index.html">auth/index</a></li><li><a href="module-utility_index.html">utility/index</a></li><li><a href="module-utility_patcher.html">utility/patcher</a></li></ul><h3>Global</h3><ul><li><a href="global.html#createImageThumbnail">createImageThumbnail</a></li><li><a href="global.html#jsonPatch">jsonPatch</a></li><li><a href="global.html#loginUser">loginUser</a></li><li><a href="global.html#Middleware">Middleware</a></li><li><a href="global.html#start">start</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Tue Apr 17 2018 12:52:57 GMT+0100 (WAT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
